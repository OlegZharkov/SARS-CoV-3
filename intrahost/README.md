#### Intrahost AV analysis result aggregrator

The `aggregator.py` script consumes a `JSON` file generated by the ENA Galaxy SARS-CoV-2 runner (Wolfgang Meier et al), and example of which can be found at `https://raw.githubusercontent.com/galaxyproject/SARS-CoV-2/master/data/cog-uk-tracking/currently_processed.json`.

The fields in the JSON as in the above example are assumed to exist and no error checking is performed (exceptions will be thrown).

The script performs three tasks

1. Download invdividual variant tables stored in `.["report"]["datamonkey_link"]` fields, filter them using command line arguments (`-c`) and produce a monolithic filtered variant TSV file to `stdout`

2. Extract meta data (`.["collection_dates"][]` and `.["time"]` for each accession number to TSV file specified via the `-a` argument.

3. For batches (`.["batch_id"]`) with 10 or more samples, perform Poisson based error rate estimation and determine per-batch cutoff levels, i.e. low frequency variants [AFâ‰¤0.25, controlled by `-f`] appearing in fewer than `K` samples are unreliable. Results are saved to a TSV file (`-d` argument)

It is further possible to exclude, include only data from specific study accessions `.["study_accession"]`; see below; (`X,Y,Z` --  X or Y or Z, `!X,Y,Z` any BUT X Y Z)

##### Example use.

Download `JSON` from the specified URL (`-u`), only use data from `PRJEB37886` project. 
Keep columns `Sample POS REF ALT AF EFFECT CODON TRID AA`, retain only variants where the value of the `FILTER` column is `PASS`. 

**Important** `-c` argument must be **LAST** because it consumes all the remaining options.

```
python3 aggregator.py 
-u 'https://raw.githubusercontent.com/galaxyproject/SARS-CoV-2/master/data/cog-uk-tracking/currently_processed.json' 
-d diagnostics.tsv 
-a meta.tsv  
-p 'PRJEB37886' 
-c Sample POS FILTER=PASS REF ALT AF EFFECT CODON TRID AA > variants.tsv
```